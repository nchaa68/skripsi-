<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MedStance</title>
    <link rel="stylesheet" href="timer.css" />
</head>

<body>
     <header class="header">
        <nav class="nav">
            <a href="#" class="nav-logo">MedStance</a>

            <ul class="nav-items">
                <li class="nav-item">
                    <a href="index.html" class="nav-link">Home</a>
                    <a href="timer.html" class="nav-link">Alarm</a>
                    <a href="medicine.html" class="nav-link">Medicine</a>
                </li>
            </ul>
        </nav>
    </header>

    <div class="container">

        <form action="" id="jadwal" autocomplete="off">
            <div class="teks">
                <p>Modify and Set Your Med-Schedule Here!</p>
            </div>
            <div>
                <label for="pilihjadwal">Pilih Alarm</label>
                <select id="pilihjadwal">
                    <option value="MS1">Morning Pill</option>
                    <option value="MS2">Day Pill</option>
                    <option value="MS3">Night Pill</option>
                </select><br><br>
            </div>
            <div>
                <label for="jam">Waktu :</label>
                <input type="time" id="jam" required><br><br>
            </div>
            <div>
                <label for="pilihobat" id="pilihobat">Pilih Obat (sesuai letak kompartemen) :</label>
                <input type="checkbox" id="medmed1" value="1">
                <label for="medmed1"> Obat 1</label> <br>
                <input type="checkbox" id="medmed2" value="2">
                <label for="medmed2"> Obat 2</label><br>
                <input type="checkbox" id="medmed3" value="3">
                <label for="medmed3"> Obat 3</label><br>
            </div>
            <div>
                <button id="jadwalkan" type="submit">Create Alarm</button>
            </div>
        </form>
    </div>

    <script type="module">
         import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
        import { getDatabase, ref, set, child, get, update} from "https://www.gstatic.com/firebasejs/10.8.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAx7gQ7QVpawuz9FgpqT6bU0Wsz2hmhNsg",
            authDomain: "crudmedlist-8b416.firebaseapp.com",
            databaseURL: "https://crudmedlist-8b416-default-rtdb.firebaseio.com",
            projectId: "crudmedlist-8b416",
            storageBucket: "crudmedlist-8b416.appspot.com",
            messagingSenderId: "415072156885",
            appId: "1:415072156885:web:ff23f8754a6d20f6c9765c"
        };

        const app = initializeApp(firebaseConfig);
        const dbRef = getDatabase(app);
        const scheduleRef = ref(dbRef, 'schedules');
        const medicineRef = ref(dbRef, 'meds');
        document.getElementById("jadwal").addEventListener("submit", async function (e) {
            e.preventDefault();

            const selectedPill = document.getElementById("pilihjadwal").value;
            const selectedTime = document.getElementById("jam").value;
            const medChecked = document.querySelectorAll("input[type='checkbox']:checked");

            if (!selectedTime) {
                alert("Please select a time.");
                return;
            }

            if (medChecked.length === 0) {
                alert("Please select at least one medication.");
                return;
            }


            const selectedMeds = Array.from(medChecked).map(input => input.value);
            const filledArray = Array(3).fill('0');

            selectedMeds.forEach(med => {
                const index = parseInt(med) - 1;
                if (index >= 0 && index < filledArray.length) {
                    filledArray[index] = med;
                }
            });

            const stringArray = '[' + filledArray.join(',') + ']';

            // Kemudian simpan stringArray dalam Firebase
            await set(child(scheduleRef, `MS${selectedPill.slice(2)}`), stringArray);

            // Simpan waktu dalam Firebase
            const tData = {};
            if (selectedPill === "MS1") {
                tData.AH1 = selectedTime.split(":")[0];
                tData.AM1 = selectedTime.split(":")[1];
            } else if (selectedPill === "MS2") {
                tData.AH2 = selectedTime.split(":")[0];
                tData.AM2 = selectedTime.split(":")[1];
            } else if (selectedPill === "MS3") {
                tData.AH3 = selectedTime.split(":")[0];
                tData.AM3 = selectedTime.split(":")[1];
            }

            // Simpan data waktu ke dalam child node T
            await update(child(scheduleRef, 'T'), tData);

            alert("Alarm berhasil di set");
            document.getElementById("jadwal").reset();
        });

    </script>
</body>

</html>

//tambahin range waktu jika dipilih day/morning/Night
//tambahin listview alarm, kalo mau ubah tinggal masukkan input baru aja, kasi notice

